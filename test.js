!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("react"),require("react-dom"),require("react-redux"),require("foundation"),require("redux-thunk"),require("redux"),require("reselect"),require("prop-types"),require("classnames")):"function"==typeof define&&define.amd?define(["react","react-dom","react-redux","foundation","redux-thunk","redux","reselect","prop-types","classnames"],t):t((e=e||self).React,e.ReactDOM,e.ReactRedux,e.Foundation,e.ReduxThunk,e.Redux,e.Reselect,e.PropTypes,e.classNames)}(this,function(c,u,e,d,n,r,t,m,p){"use strict";var f="default"in c?c.default:c;u=u&&u.hasOwnProperty("default")?u.default:u,n=n&&n.hasOwnProperty("default")?n.default:n,m=m&&m.hasOwnProperty("default")?m.default:m,p=p&&p.hasOwnProperty("default")?p.default:p;var a,s=(a=f.Component,babelHelpers.inherits(o,a),babelHelpers.createClass(o,[{key:"componentDidMount",value:function(){var t=this;d.getFeedbackLink(this.props.subject).then(function(e){return t.setState({href:e})})}},{key:"render",value:function(){var e=this.props.href&&this.props.subject?this.props.subject:"",t=this.props.href?this.props.href+"?subject="+e:this.state.href;return f.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:t},this.props.children)}}]),o);function o(e){babelHelpers.classCallCheck(this,o);var t=babelHelpers.possibleConstructorReturn(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.state={href:"mailto:NYTCrossword@nytimes.com"},t}s.propTypes={subject:m.string,href:m.string,children:m.string};var l=function(e){e.toggleModal;return f.createElement(f.Fragment,null,f.createElement("h3",{className:"sb-modal-title"},"How to Play"),f.createElement("h4",{className:"sb-modal-heading"},"Create words using letters from the hive."),f.createElement("ul",{className:"sb-modal-list"},f.createElement("li",null,"Words must contain at least 4 letters."),f.createElement("li",null,"Words must include the center letter."),f.createElement("li",null,"Our word list does not include words that are obscure, hyphenated, or proper nouns."),f.createElement("li",null,"No cussing either, sorry."),f.createElement("li",null,"Letters can be used more than once.")),f.createElement("h4",{className:"sb-modal-heading"},"Score points to increase your rating."),f.createElement("ul",{className:"sb-modal-list"},f.createElement("li",null,"4-letter words are worth 1 point each."),f.createElement("li",null,"Longer words earn 1 point per letter."),f.createElement("li",null,"Each puzzle includes at least one â€œpangramâ€ which uses every letter. These are worth 7 extra points!")),f.createElement("p",{className:"sb-modal-message"},"New puzzles are released daily at 3:00 a.m. ET."),f.createElement("p",{className:"sb-modal-message"},"Think we missed a word? Email us at"," ",f.createElement(s,{subject:"Spelling Bee Word Suggestion",href:"mailto:buzzwords@nytimes.com"},"buzzwords@nytimes.com"),"."),f.createElement("p",{className:"sb-modal-message"},"Have feedback? Email us atâ€‚",f.createElement(s,{subject:"Spelling Bee Feedback"},"NYTCrossword@nytimes.com"),"."))};l.propTypes={toggleModal:m.func};function i(e){var t=e.ranks;return f.createElement(f.Fragment,null,f.createElement("h3",{className:"sb-modal-title"},"Rankings"),f.createElement("p",{className:"sb-modal-message"},"Ranks are based on a percentage of possible points in a puzzle. The minimum scores to reach each rank for todayâ€™s are:"),f.createElement("ol",{className:"sb-modal-list"},t.map(function(e){var t=e.minScore,n=e.title;return f.createElement("li",{key:n},n+" ("+t+")")})),f.createElement("p",{className:"sb-modal-message"},"Have feedback? Email us atâ€‚",f.createElement(s,{subject:"Spelling Bee Feedback"},"NYTCrossword@nytimes.com"),"."))}i.propTypes={ranks:m.arrayOf(m.shape({minScore:m.number.isRequired,title:m.string.isRequired}))};function g(){window.localStorage.removeItem(_)}function b(e){return d.xhr.get(d.env.api+"/svc/spelling-bee/v1/game/"+e+".json").then(function(e){return e.answers}).catch(function(e){console.error("unable to get remote progress",e)})}function h(e,t){return t.length?d.xhr.put(d.env.api+"/svc/spelling-bee/v1/game.json",{puzzleID:e,answers:t}):Promise.resolve()}function v(t,n,r){function a(){if(window.SIMULATE_OFFLINE)return Promise.reject(new Error("simulating offline"));var e=t.getState().foundWords;!function(e,t){if(t.length)try{window.localStorage.setItem(_,JSON.stringify({id:e,words:t}))}catch(e){console.error("local storage failure:",e)}}(s,e),h(s,e).catch(function(e){console.error("unable to save remote progress",e)})}var e=t.getState(),s=e.id,o=e.yesterday.id,l=function(e){var t=void 0,n=window.localStorage.getItem(_);if(n)try{var r=JSON.parse(n);t=r.words,e!==r.id&&(t=g())}catch(e){t=g(),console.error("could not parse local progress: "+n)}return t}(s),i=0;b(o).then(function(e){r(e)}),l&&(i=l.length,n(l)),b(s).then(function(e){e&&n(e),a()}),t.subscribe(function(){var e=t.getState().foundWords;i!==e.length&&(i=e.length,0===e.length?(function(e){delete window.resetProgressComplete,d.xhr.delete(d.env.api+"/svc/spelling-bee/v1/game/"+e+".json").then(function(){window.resetProgressComplete=!0}).catch(function(e){console.error(e)})}(s),g()):a())}),window.addEventListener("online",a)}var y,E,w,N,k=e.connect(function(e){return{ranks:Me(e)}})(i),_="sb-today",C=["modal","gameplay","settings","general"],S=["tech","gameplay","settings"],L=(y="SB",E=d.getGameData().today.id,w=y+"-"+E,N={interaction:{},impression:{}},C.forEach(function(n){N.interaction[n]=function(e,t){return T("moduleInteraction",n,e,t)}}),S.forEach(function(n){N.impression[n]=function(e,t){return T("impression",n,e,t)}}),N);function T(e,t,n,r){d.track(e,"moduleInteraction"===e?{module:{name:t,context:w,element:{name:n||"",label:"string"==typeof r?r:JSON.stringify(r)}},eventData:{pageType:"game",type:"click",trigger:"module",status:""}}:{module:{name:t,context:w,region:n||"",label:"string"==typeof r?r:JSON.stringify(r)}})}function O(e){var t=e.children,n=void 0===t?"Back to the hub":t,r=e.triggerName,a=e.disabled;return f.createElement("a",{className:p("sb-modal-button",{disabled:a}),href:"/puzzles",onClick:function(e){if(a)return e.preventDefault();L.interaction.gameplay("back-to-hub",r)}},n)}O.propTypes={children:m.string,triggerName:m.string.isRequired,disabled:m.bool};var W,M=(W=f.Component,babelHelpers.inherits(x,W),babelHelpers.createClass(x,[{key:"componentDidMount",value:function(){var t=this,e=this.props,n=e.foundWords,r=e.id;h(r,n).then(function(e){t.setState({pending:!1})}).catch(function(){t.setState({buttonText:"Something went wrong",message:"Your progress is stored on this device but may not be synced to other devices."})})}},{key:"render",value:function(){return f.createElement(f.Fragment,null,f.createElement("div",{className:"sb-modal-image bee-sleepy"}),f.createElement("h3",{className:"sb-modal-title"},"See you later"),f.createElement("p",{className:"sb-modal-message"},this.state.message),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement(O,{disabled:this.state.pending,triggerName:"see-you-later"},this.state.buttonText)))}}]),x);function x(e){babelHelpers.classCallCheck(this,x);var t=babelHelpers.possibleConstructorReturn(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,e));return t.state={buttonText:"Back to the hub",message:"Your progress auto-saves, so feel free to leave and come back later today.",pending:!0},t}M.propTypes={foundWords:m.arrayOf(m.string),id:m.number};function H(e){var t=e.editor;return f.createElement(f.Fragment,null,f.createElement("div",{className:"sb-modal-image bee-ready"}),f.createElement("h3",{className:"pz-modal__title"},"Spelling Bee"),f.createElement("p",{className:"pz-modal__message"},"How many words can you make with 7 letters?"),f.createElement("div",{className:"pz-byline"},f.createElement("span",{className:"pz-byline__text"},"Edited by ",t)))}var z=e.connect(function(e){return{foundWords:e.foundWords,id:e.id}})(M),D={"cutoff-start":"7F9J7","cutoff-stop":"79XQU","cutoff-welcome-back":"7KK8Q","credits-start":"7H7QU","credits-no-plays":"7X8YL",genius:"79JY7","queen-bee":"7UWXR"};H.propTypes={editor:m.string};function j(e){var t=e.wordCount,n=e.score;return f.createElement(f.Fragment,null,f.createElement("h3",{className:"pz-modal__title"},"Welcome Back"),f.createElement("p",{className:"pz-modal-message"},"Youâ€™ve found",f.createElement("em",null," "+t+"Â word"+(1<t?"s":"")),f.createElement("br",null),"and have",f.createElement("em",null," "+n+"Â point"+(1<n?"s":"")),"."))}j.propTypes={wordCount:m.number,score:m.number};function R(e){var t=e.toggleModal;return f.createElement("button",{className:"pz-modal__button white",onClick:function(){return t("yesterday","get-started")}},"Yesterday")}R.propTypes={toggleModal:m.func.isRequired};function P(e){var t=e.toggleModal,n=e.isReturning;return f.createElement("button",{className:"pz-modal__button dark",onClick:function(){t(null,"get-started")}},n?"Continue":"Play")}P.propTypes={toggleModal:m.func.isRequired,isReturning:m.bool};function A(e){var t=e.tag,n=void 0===t?"cutoff-start":t,r=e.style,a=void 0===r?"white":r;return f.createElement("button",{className:"pz-modal__button "+a,onClick:function(){try{d.abra.reportExposure(K)}catch(e){}return window.location.href=function(e,t){switch(e){case"1_no_faux_lp":return"/subscription/crosswords?campaignId="+D[t];default:return"/puzzles/subscribe/spelling-bee?campaign="+t}}(d.abra.get(K),n),null}},"Subscribe")}var K="GAMES_TP14_FauxLP";A.propTypes={tag:m.string,style:m.string};function I(e){var t=e.score,n=e.wordCount,r=e.toggleModal,a=e.editor,s=0<n,o=s?"returning":"new";return f.createElement("div",{className:"welcome-modal "+o},s?f.createElement(j,{wordCount:n,score:t}):f.createElement(H,{editor:a}),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement(P,{toggleModal:r,isReturning:s}),f.createElement("div",{className:"pz-button__wrapper"},f.createElement("button",{className:"pz-modal__button white",onClick:function(){return r("help","get-started")}},"Rules"),f.createElement(R,{toggleModal:r}))))}I.propTypes={toggleModal:m.func.isRequired,wordCount:m.number,score:m.number,editor:m.string};function B(e){var t=e.lock,n=e.score,r=e.wordCount,a=e.toggleModal,s=e.editor,o=0<r,l=o?"returning":"new";return e.cutoff?(t(),f.createElement("div",{className:"welcome-modal returning"},f.createElement("h3",{className:"pz-modal__title"},"Welcome Back"),f.createElement("p",{className:"pz-modal-message"},"Subscribe to continue playing Spelling Bee or come back tomorrow."),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement(A,{tag:"cutoff-stop",style:"dark"})))):f.createElement("div",{className:"welcome-modal "+l},o?f.createElement(j,{wordCount:r,score:n}):f.createElement(H,{editor:s}),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement(P,{toggleModal:a,isReturning:o}),f.createElement("div",{className:"pz-button__wrapper"},f.createElement("button",{className:"pz-modal__button white",onClick:function(){return a("help","get-started")}},"Rules"),d.userType.hasXwd?f.createElement(R,{toggleModal:a}):f.createElement(A,{tag:o?"cutoff-welcome-back":"cutoff-start",style:"dark"}))))}var F=e.connect(function(e){var t=e.foundWords,n=e.editor;return{wordCount:t.length,score:We(e),editor:n}})(I);B.propTypes={toggleModal:m.func.isRequired,wordCount:m.number,score:m.number,editor:m.string,lock:m.func,cutoff:m.bool};function U(e){var t=e.hasCompleted,n=e.toggleModal,r=e.score,a=e.wordCount,s=e.isHalloween;return t?f.createElement(f.Fragment,null,f.createElement("div",{className:"sb-modal-image bee-queen"}),f.createElement("h3",{className:"sb-modal-title"},"Queen Bee"),f.createElement("p",{className:"sb-modal-message"},"You found everything! All ",f.createElement("em",null,a+"Â words"),", worth ",f.createElement("em",null,r+"Â points"),"."),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement(O,{triggerName:"completed-modal"}))):f.createElement(f.Fragment,null,f.createElement("div",{className:p("sb-modal-image",s?"bee-spooky":"bee-smarty")}),f.createElement("h3",{className:"sb-modal-title"},"Genius"),f.createElement("p",{className:"sb-modal-message"},"You reached the highest rank, with ",f.createElement("em",null,a+"Â words")," and ",f.createElement("em",null,r+"Â points"),"."),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement("button",{className:"sb-modal-button sb-modal-button-secondary",onClick:function(){return n()}},"Keep playing"),f.createElement(O,{triggerName:"genius-modal"})))}var G=e.connect(function(e){var t=e.foundWords,n=e.editor;return{wordCount:t.length,score:We(e),editor:n,cutoff:je(e)}})(B);U.propTypes={toggleModal:m.func,hasCompleted:m.bool,wordCount:m.number,score:m.number,isHalloween:m.bool};function q(e){var t=e.value,n=e.centerLetter,r=[],a=t.split(n),s=0;return a.forEach(function(e,t){0<t&&r.push(f.createElement("span",{key:s++,className:"sb-anagram-key"},n)),e&&r.push(e)}),f.createElement("span",{className:"sb-anagram"},r)}var Y=e.connect(function(e){return{hasCompleted:De(e),wordCount:e.foundWords.length,score:We(e),isHalloween:/10-31/.test(e.printDate)}})(U);q.propTypes={value:m.string,centerLetter:m.string};var X,J=(X=f.Component,babelHelpers.inherits(Q,X),babelHelpers.createClass(Q,[{key:"render",value:function(){var e=this.props,t=e.displayDate,n=e.centerLetter,r=e.validLetters,a=e.answers,s=e.foundWords;return f.createElement(f.Fragment,null,f.createElement("h3",{className:"sb-modal-title"},"Yesterdayâ€™s Answers"),f.createElement("div",{className:"sb-modal-date__yesterday"},t),f.createElement("div",{className:"sb-modal-letters"},r),f.createElement("div",{className:"sb-modal-wordlist"},f.createElement("ul",{className:"sb-modal-wordlist-items"},a.map(function(e){return f.createElement("li",{key:e,"data-testid":"yesterdays-answer-word"},f.createElement(q,{value:e,centerLetter:n}),s.includes(e)&&f.createElement("span",{className:"check"}))}))))}}]),Q);function Q(){return babelHelpers.classCallCheck(this,Q),babelHelpers.possibleConstructorReturn(this,(Q.__proto__||Object.getPrototypeOf(Q)).apply(this,arguments))}J.propTypes={displayDate:m.string,centerLetter:m.string,validLetters:m.arrayOf(m.string),answers:m.arrayOf(m.string),foundWords:m.arrayOf(m.string)};function V(e){var t=e.lock;return f.useEffect(function(){t()},[]),f.createElement("div",{className:"welcome-modal new"},f.createElement("div",{className:"sb-modal-image bee-loved"}),f.createElement("h3",{className:"pz-modal__title"},"Youâ€™re pretty good at this!"),f.createElement("p",{className:"pz-modal-message"},"Know more words? Subscribe to rank up even more."),f.createElement("div",{className:"sb-modal-buttons-section"},f.createElement("div",{className:"pz-button__wrapper"},f.createElement(function(){return f.createElement("button",{className:"pz-modal__button white",onClick:function(){return window.location.href="http://nytimes.com/puzzles",null}},"Quit")},null),f.createElement(A,{tag:"cutoff-stop",style:"dark"}))))}var Z=e.connect(function(e){var t=e.yesterday;return{displayDate:t.displayDate,centerLetter:t.centerLetter,validLetters:t.validLetters,answers:t.answers,foundWords:t.foundWords}})(J);V.propTypes={lock:m.func};function $(e){var t=e.children,n=e.toggleModal,r=e.modalType,a=[l,k,Z].includes(te[r]),s=f.createElement("div",{className:"sb-modal-close",onClick:function(){return n()}},"Ã—");return f.createElement("div",{className:p("sb-modal-frame",{"left-aligned":a},r),onClick:function(e){return e.stopPropagation()}},a&&s,f.createElement("div",{className:"sb-modal-content"},t))}var ee=d.userType.hasXwd?0:4,te={start:0<ee?G:F,help:l,ranks:k,save:z,congrats:Y,yesterday:Z,cutoff:V};$.propTypes={toggleModal:m.func,children:m.element,modalType:m.string};function ne(e,t){return fe.toggleModal(e,t)}function re(t){return new Promise(function(e){setTimeout(e,t)})}function ae(e,t){return e.length<5?1:e.length+(t?7:0)}function se(e,n){return e.reduce(function(e,t){return e+ae(t,n.includes(t))},0)}function oe(t,e){var n=e.type,r=e.payload;switch(n){case ye:return Object.assign({},t,{input:[].concat(babelHelpers.toConsumableArray(t.input),[r])});case Ee:return Object.assign({},t,{input:t.input.slice(0,-1)});case ve:return Object.assign({},t,{outerLetters:function e(t,n){for(var r=[].concat(babelHelpers.toConsumableArray(t)),a=r.length;a;){var s=Math.floor(Math.random()*a--),o=r[a];if(r[a]=r[s],r[s]=o,n&&(t[a]===r[a]||t[s]===r[s]))return e(t,!0)}return r}(t.outerLetters,!0)});case we:return Object.assign({},t,{input:[]});case Ne:return Object.assign({},t,{foundWords:[].concat(babelHelpers.toConsumableArray(t.foundWords),[r])});case Se:return Object.assign({},t,{expandedWordlist:!t.expandedWordlist});case"LOCK":return Object.assign({},t,{isLocked:!0});case"UNLOCK":return Object.assign({},t,{isLocked:!1});case ke:return Object.assign({},t,{message:r});case _e:return Object.assign({},t,{message:null});case Ce:return Object.assign({},t,{input:[],message:null});case Te:return Object.assign({},t,{foundWords:[].concat(babelHelpers.toConsumableArray(t.foundWords),babelHelpers.toConsumableArray(r.filter(function(e){return t.answers.includes(e)&&!t.foundWords.includes(e)})))});case Oe:return Object.assign({},t,{yesterday:Object.assign({},t.yesterday,{foundWords:[].concat(babelHelpers.toConsumableArray(r||[])),fetched:!0})});case Le:return Object.assign({},t,{foundWords:[]});default:return t}}function le(e){return se(e.answers,e.pangrams)}function ie(){return{type:Se}}function ce(a){return function(e,t){e({type:ke,payload:a});var n=a.isError?1100:900,r=a.isError?Ce:_e;return re(n).then(function(){t().message&&e({type:r})})}}function ue(){return function(e,t){e({type:ve})}}function de(l){return function(e,t){var n=t();if(!n.isLocked&&(l=l||n.input.join("")).length){if(window.cheat&&l.split("").every(function(e){return e===n.centerLetter}))return window.cheat(l.length);window.reset&&function(e,t){var n=0<arguments.length&&void 0!==e?e:[],r=1<arguments.length&&void 0!==t?t:[];return[].concat(babelHelpers.toConsumableArray(n)).sort().join()===[].concat(babelHelpers.toConsumableArray(r)).sort().join()}(l.split(""),n.outerLetters)&&window.reset();var r=function(e,t){var n=e.split("");return e.length<4?"TooÂ short":n.some(function(e){return!t.validLetters.includes(e)})?"BadÂ letters":e.includes(t.centerLetter)?t.answers.includes(e)?t.foundWords.includes(e)?"AlreadyÂ found":void 0:"NotÂ inÂ wordÂ list":"MissingÂ centerÂ letter"}(l,n);if(r)e(ce({value:r,isError:!0}));else{e({type:Ne,payload:l});var a=n.pangrams.includes(l),s=ae(l,a),o=function(e,t){return t?"Pangram!":7<=e?"Awesome!":1<e?"Nice!":"Good!"}(s,a);e({type:we}),e(ce({value:o,points:s,isPangram:a}))}}}}function me(c){var u=void 0;return function(i){return function(e){var t=c.getState(),n=i(e);if(e.type===Se&&(t.expandedWordlist?L.interaction.gameplay("close-word-list",(new Date).getTime()-u):u=(new Date).getTime()),e.type===Ne){var r=c.getState(),a=xe(t),s=xe(r);if(a<s)for(var o=a+1;o<=s;o+=1){var l=he[o][0];L.interaction.gameplay("level-up",o+"-"+l.replace(" ","-").toLowerCase())}!De(t)&&De(r)&&L.interaction.gameplay("level-up",xe(r)+1+"-completed")}return n}}}function pe(l){return function(o){return function(e){var t=l.getState(),n=o(e);if(e.type===Ne){var r=l.getState(),a=!ze(t)&&ze(r),s=!De(t)&&De(r);je(r)&&setTimeout(function(){ne("cutoff","in-game")},450),(a||s)&&setTimeout(function(){ne("congrats","in-game")},450)}return n}}}var fe=function(s,o,l){var e,i={},t=Object.keys(s),n=(e=c.Component,babelHelpers.inherits(r,e),babelHelpers.createClass(r,[{key:"lock",value:function(){this.setState({locked:!0})}},{key:"unlock",value:function(){this.setState({locked:!1})}},{key:"setThenWaitThenSet",value:function(e,t){var n=this;this.setState(function(){return Object.assign({},e)},function(){return setTimeout(function(){n.setState(t)},150)})}},{key:"toggleModal",value:function(e,t){var n=this.state,r=n.isOpen;n.locked||((e="string"==typeof e&&e)?(this.props.onOpen&&this.props.onOpen(e,t),r?this.setState({currentModal:e}):this.setThenWaitThenSet({},{isOpen:!0,currentModal:e})):(this.props.onClose&&this.props.onClose(this.state.currentModal,t),this.setThenWaitThenSet({isClosing:!0},{isClosing:!1,isOpen:!1,currentModal:null})))}},{key:"render",value:function(){var e=this.state,t=e.isOpen,n=e.isClosing,r=e.currentModal,a=s[r]||null;return u.createPortal(f.createElement("div",{className:p("sb-modal-system",{"sb-modal-open":t,"sb-modal-closing":n})},f.createElement("div",{className:"sb-modal-scrim",onClick:i.toggleModal},f.createElement("div",{className:"sb-modal-wrapper"},r&&f.createElement(o,{key:r,toggleModal:i.toggleModal,modalType:r},f.createElement(a,{toggleModal:i.toggleModal,modalType:r,lock:i.lock,unlock:i.unlock}))))),l)}}]),r);function r(e){babelHelpers.classCallCheck(this,r);var t=babelHelpers.possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e));return t.state={currentModal:e.initialModal||null,isOpen:!!e.initialModal,isClosing:!1},i.toggleModal=t.toggleModal.bind(t),i.lock=t.lock=t.lock.bind(t),i.unlock=t.unlock=t.unlock.bind(t),t.setThenWaitThenSet=t.setThenWaitThenSet.bind(t),t}n.propTypes={initialModal:m.oneOf(t),onClose:m.func,onOpen:m.func};function a(e){var t=e.modal,n=e.children,r=e.className,a=e.triggerName;return f.createElement("span",{className:r,onClick:function(){i.toggleModal(t,a)}},n)}return a.propTypes={modal:m.oneOf(t),className:m.string,triggerName:m.string,children:m.oneOfType([m.string,m.element,m.arrayOf(m.element)])},i.Modals=n,i.ModalButton=a,i}(te,$,document.getElementById("portal-game-modals")),ge=fe.Modals,be=fe.ModalButton,he=[["Beginner",0],["Good Start",2],["Moving Up",5],["Good",8],["Solid",15],["Nice",25],["Great",40],["Amazing",50],["Genius",70]],ve="SHUFFLE",ye="INPUT_LETTER",Ee="DELETE_LETTER",we="CLEAR_INPUT",Ne="ACCEPT_WORD",ke="SHOW_MESSAGE",_e="CLEAR_MESSAGE",Ce="CLEAR_MESSAGE_AND_INPUT",Se="TOGGLE_WORDLIST",Le="RESET_GAME",Te="INSERT_FOUND_WORDS",Oe="SET_YESTERDAYS_FOUND_WORDS",We=function(e){return se(e.foundWords,e.pangrams)},Me=t.createSelector(le,function(a){return he.map(function(e){var t=babelHelpers.slicedToArray(e,2),n=t[0],r=t[1];return{title:n,minScore:Math.round(r/100*a)}})}),xe=t.createSelector([We,Me],function(e,t){var n=void 0;for(n=0;n<t.length&&!(e<t[n].minScore);n+=1);return n-1}),He=t.createSelector(xe,function(e){return he[e][0]}),ze=t.createSelector([We,xe],function(e,t){return t===he.length-1}),De=t.createSelector([We,le],function(e,t){return e===t}),je=t.createSelector([xe],function(e){return 0<ee&&ee<=e}),Re=window,Pe="touchstart",Ae="touchend",Ke="mousedown",Ie="mouseup",Be="mouseout",Fe="addEventListener",Ue="removeEventListener",Ge="push-active",qe=!1;if("function"==typeof Re.addEventListener){var Ye=!1,Xe=Object.defineProperty({},"passive",{get:function(){Ye=!0}}),Je=function(){};Re.addEventListener("testPassiveEventSupport",Je,Xe),Re.removeEventListener("testPassiveEventSupport",Je,Xe),qe=Ye}function Qe(t,n,r,a){function e(e){qe||e.preventDefault(),o&&t.classList.add(Ge),a&&!i&&(i=setTimeout(function(){l=setInterval(function(){n(e)},90)},350)),n(e)}function s(e){e.cancelable&&e.preventDefault(),o&&t.classList.remove(Ge),l=l&&clearInterval(l),i=i&&clearTimeout(i),r&&r(e)}var o=!!t.classList,l=void 0,i=void 0;return t[Fe](Pe,e,Ze),t[Fe](Ke,e),t[Fe](Ae,s),t[Fe](Ie,s),t[Fe](Be,s),function(){l=l&&clearInterval(l),i=i&&clearTimeout(i),t[Ue](Pe),t[Ue](Ke),t[Ue](Ae),t[Ue](Ie),t[Ue](Be)}}var Ve,Ze={passive:!0},$e=Math.pow(3,.5),et=2*$e,tt=[[0,$e],[1,0],[3,0],[4,$e],[3,et],[1,et]].map(function(e){return e.map(function(e){return 30*e}).join()}).join(" "),nt=(Ve=c.Component,babelHelpers.inherits(rt,Ve),babelHelpers.createClass(rt,[{key:"componentDidMount",value:function(){this.unbind=Qe(this._el,this.props.onDown,this.props.onUp,!0)}},{key:"componentWillUnmount",value:function(){this.unbind()}},{key:"render",value:function(){var t=this,e=this.props,n=e.activeKey,r=e.letter,a=e.type;return f.createElement("svg",{className:p("hive-cell",a),viewBox:"0 0 120 "+30*et},f.createElement("polygon",{ref:function(e){return t._el=e},className:p("cell-fill",{"push-active":r===n}),points:tt,stroke:"white",strokeWidth:7.5}),f.createElement("text",{className:"cell-letter",x:"50%",y:"50%",dy:"10.75%"},r))}}]),rt);function rt(){return babelHelpers.classCallCheck(this,rt),babelHelpers.possibleConstructorReturn(this,(rt.__proto__||Object.getPrototypeOf(rt)).apply(this,arguments))}nt.propTypes={letter:m.string,activeKey:m.string,type:m.oneOf(["center","outer"]),onDown:m.func,onUp:m.func,children:m.oneOfType([m.string,m.element,m.arrayOf(m.element)])};var at,st=(at=c.Component,babelHelpers.inherits(ot,at),babelHelpers.createClass(ot,[{key:"componentDidMount",value:function(){this.unbind=Qe(this.button,this.props.onDown,this.props.onUp,this.props.allowBurst)}},{key:"componentWillUnmount",value:function(){this.unbind()}},{key:"render",value:function(){var t=this,e=this.props,n=e.className,r=e.children;return f.createElement("div",{ref:function(e){t.button=e},className:p(n,"sb-touch-button")},r)}}]),ot);function ot(){return babelHelpers.classCallCheck(this,ot),babelHelpers.possibleConstructorReturn(this,(ot.__proto__||Object.getPrototypeOf(ot)).apply(this,arguments))}st.propTypes={className:m.string,onDown:m.func,onUp:m.func,allowBurst:m.bool,children:m.oneOfType([m.string,m.element,m.arrayOf(m.element)])};var lt,it=/[a-z]/,ct=(lt=c.Component,babelHelpers.inherits(ut,lt),babelHelpers.createClass(ut,[{key:"componentDidMount",value:function(){window.addEventListener("keydown",this.handleKeydown,!1),window.addEventListener("keyup",this.handleKeyup,!1)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("keydown",this.handleKeydown),window.removeEventListener("keyup",this.handleKeyup)}},{key:"handleKeydown",value:function(e){if(!e.metaKey){var t=void 0;if(8===e.keyCode||46===e.keyCode)t="delete",this.props.deleteLetter(),e.preventDefault();else if(13===e.which)t="submit",this.props.submitWord(),e.preventDefault();else if(32===e.keyCode)t="shuffle",this.handleShuffle(),e.preventDefault();else{var n=String.fromCharCode(e.which).toLowerCase();!function(e){return it.exec(e)}(n)||(t=n,this.props.inputLetter(t))}this.setState({activeKey:t})}}},{key:"handleKeyup",value:function(e){this.setState({activeKey:null})}},{key:"handleShuffle",value:function(){var e=this;this.state.shuffleStage||(this.setState({shuffleStage:"beforeShuffle"}),re(300).then(function(){e.setState({shuffleStage:"shuffling"}),e.props.shuffleLetters()}).then(function(){return re(10)}).then(function(){return e.setState({shuffleStage:"afterShuffle"})}).then(function(){return re(300)}).then(function(){return e.setState({shuffleStage:null})}))}},{key:"render",value:function(){var e=this,t=this.props,n=t.centerLetter,r=t.inputLetter,a=t.deleteLetter,s=t.submitWord,o=this.state,l=o.activeKey,i=o.shuffleStage,c=[f.createElement(nt,{key:n,letter:n,activeKey:l,onDown:function(){return r(n)},type:"center"})].concat([this.props.outerLetters.map(function(e){return f.createElement(nt,{key:e,letter:e,activeKey:l,onDown:function(){return r(e)},className:l===e?"cell-down":"",type:"outer"})})]);return f.createElement(f.Fragment,null,f.createElement("div",{className:"sb-hive"},f.createElement("div",{className:p("hive",{"fade-out":"beforeShuffle"===i},{shuffling:"shuffling"===i},{"fade-in":"afterShuffle"===i})},c)),f.createElement("div",{className:"hive-actions"},f.createElement(st,{allowBurst:!0,className:p("hive-action","hive-action__delete",{"action-active":"delete"===l}),onDown:function(){return a()}},"Delete"),f.createElement(st,{className:p("hive-action","hive-action__shuffle",{"action-active":"shuffle"===l}),onDown:function(){return e.handleShuffle()}}),f.createElement(st,{className:p("hive-action","hive-action__submit",{"action-active":"submit"===l}),onDown:function(){return s()}},"Enter")))}}]),ut);function ut(e){babelHelpers.classCallCheck(this,ut);var t=babelHelpers.possibleConstructorReturn(this,(ut.__proto__||Object.getPrototypeOf(ut)).call(this,e));return t.state={activeKey:null,shuffleStage:null},t.handleKeyup=t.handleKeyup.bind(t),t.handleKeydown=t.handleKeydown.bind(t),t.handleShuffle=t.handleShuffle.bind(t),t}ct.propTypes={shuffleLetters:m.func,submitWord:m.func,inputLetter:m.func,deleteLetter:m.func,centerLetter:m.string,outerLetters:m.arrayOf(m.string)};function dt(e){var t=e.input,n=e.centerLetter,r=e.validLetters,a=e.message;return f.createElement("div",{className:"sb-hive-input"},f.createElement("span",{className:p("sb-hive-input-content",{"non-empty":!!t.length,"has-error":a&&a.isError,"is-accepting":a&&!a.isError}),style:{fontSize:function(e){return e<13?"32px":32-1.5*(e-13)+"px"}(t.length)}},t.length?t.map(function(e,t){return f.createElement("span",{key:t,className:p({"sb-input-bright":n===e,"sb-input-invalid":!r.includes(e)})},e)}):f.createElement("span",null,"Â ")))}var mt=e.connect(function(e){return{centerLetter:e.centerLetter,outerLetters:e.outerLetters}},function(t){return{deleteLetter:function(){return t(function(e,t){var n=t();n.isLocked||(n.message&&n.message.isError?e({type:Ce}):e({type:Ee}))})},inputLetter:function(e){return t(function(r){return function(e,t){var n=t();n.isLocked||(18<n.input.length?e(ce({value:"TooÂ long",isError:!0})):(n.message&&n.message.isError&&e({type:Ce}),e({type:ye,payload:r})))}}(e))},submitWord:function(){return t(de())},shuffleLetters:function(){return t(ue())}}})(ct);dt.propTypes={message:m.shape({}),centerLetter:m.string,validLetters:m.arrayOf(m.string),input:m.arrayOf(m.string)};function pt(e){var t=e.words,n=e.centerLetter;return e.expandedWordlist,e.toggleWordlist,f.createElement("div",{className:"sb-wordlist"},f.createElement("ul",{className:"sb-wordlist-items"},t.map(function(e){return f.createElement("li",{key:e},f.createElement(q,{value:e,centerLetter:n}))})))}var ft=e.connect(function(e){var t=e.centerLetter,n=e.outerLetters,r=e.input;return{message:e.message,centerLetter:t,validLetters:[t].concat(n),input:r}})(dt);pt.propTypes={words:m.arrayOf(m.string),centerLetter:m.string,expandedWordlist:m.bool,toggleWordlist:m.func};function gt(e){var t=e.wordCount,n=e.recentWords,r=e.centerLetter,a=e.expandedWordlist,s=e.toggleWordlist;return f.createElement(st,{className:"sb-wordlist-heading-wrap",onDown:s},f.createElement("div",{className:"sb-wordlist-summary"},"You have found ",t," ",1===t?"word":"words"),f.createElement("div",{className:"sb-recent-words-wrap"},f.createElement("ul",{className:p("sb-recent-words",{"sb-has-words":0<n.length})},n.length?n.map(function(e){return f.createElement("li",{key:e},f.createElement(q,{value:e,centerLetter:r}))}):f.createElement("li",{key:"none",className:"sb-placeholder-text"},"Your words â€¦"))),f.createElement("div",{className:"sb-toggle-expand"},f.createElement("span",{className:p("sb-toggle-icon",{"sb-toggle-icon-expanded":a})})))}var bt=e.connect(function(e){return{words:e.foundWords.slice().sort(function(e,t){return t<e?1:-1}),centerLetter:e.centerLetter,expandedWordlist:e.expandedWordlist}},function(e){return{toggleWordlist:function(){return e(ie())}}})(pt);gt.propTypes={wordCount:m.number,recentWords:m.arrayOf(m.string),centerLetter:m.string,expandedWordlist:m.bool,toggleWordlist:m.func};function ht(e){var t=e.score,n=e.rank,r=e.rankIdx,a=e.ranks;return f.createElement(be,{modal:"ranks",triggerName:"in-game"},f.createElement("div",{className:"sb-progress",title:"Click to see todayâ€™s ranks"},f.createElement("h4",{className:"sb-progress-rank"},n),f.createElement("div",{className:"sb-progress-line"},f.createElement("div",{className:"sb-progress-dots"},a.map(function(e,t){return f.createElement("span",{key:t,className:p("sb-progress-dot",{completed:t<r})})})),f.createElement("div",{className:p("sb-progress-marker",{final:r===a.length-1}),style:{left:r/(a.length-1)*100+"%"}},f.createElement("span",{className:"sb-progress-value"},t)))))}var vt=e.connect(function(e){return{wordCount:e.foundWords.length,recentWords:e.foundWords.slice().reverse(),centerLetter:e.centerLetter,expandedWordlist:e.expandedWordlist}},function(e){return{toggleWordlist:function(){return e(ie())}}})(gt);ht.propTypes={score:m.number,rank:m.string,rankIdx:m.number,ranks:m.arrayOf(m.shape([]))};function yt(e){var t=e.message;return f.createElement("div",{className:p("sb-message-box",{"error-message":t&&t.isError,"success-message":t&&!t.isError,"pangram-message":t&&t.isPangram})},t&&f.createElement("span",{className:"sb-message"},t.value),t&&t.points&&f.createElement("span",{className:"sb-message-points"},"+",t.points))}var Et=e.connect(function(e){return{score:We(e),ranks:Me(e),rankIdx:xe(e),rank:He(e)}})(ht);yt.propTypes={message:m.shape({})};var wt=e.connect(function(e){return{message:e.message}})(yt);d.mobileNavTools.create([{type:"text",value:"Help",action:function(){return ne("help","toolbar")}},{type:"text",value:"Save",action:function(){return ne("save","toolbar")}}]);function Nt(e){return e.toggle,u.createPortal(f.createElement(f.Fragment,null,f.createElement("div",null,f.createElement(be,{className:"pz-toolbar-button pz-toolbar-button__help",modal:"help",triggerName:"toolbar"},"Help"),f.createElement(be,{className:"pz-toolbar-button pz-toolbar-button__save",modal:"save",triggerName:"toolbar"},"Save & Quit")),f.createElement(be,{className:"pz-toolbar-button pz-toolbar-button__yesterday",modal:"yesterday",triggerName:"toolbar"},"Yesterdayâ€™s Answers")),Ct)}function kt(e,t,n){L.interaction.modal((St[e]||e)+"|"+t,n)}function _t(e){var t=e.expandedWordlist,n=e.isLocked,r=e.lockGame,a=e.unlockGame,s=e.initialModal;return f.createElement("div",{className:p("sb-content-box",{"sb-expanded":t,"sb-game-locked":n})},f.createElement(Nt,null),f.createElement(ge,{onOpen:function(e,t){r(),kt(e,"open",t)},onClose:function(e,t){a(),d.mobileNavTools.activate(),kt(e,"close",t)},initialModal:s}),f.createElement("div",{className:"sb-controls-box"},f.createElement("div",{className:"sb-controls"},f.createElement(wt,null),f.createElement(ft,null),f.createElement(mt,null))),f.createElement("div",{className:"sb-status-box"},f.createElement("div",{className:"sb-progress-box"},f.createElement(Et,null)),f.createElement("div",{className:"sb-wordlist-box"},f.createElement("div",{className:"sb-wordlist-heading"},f.createElement(vt,null)),f.createElement("div",{className:"sb-wordlist-drawer"},f.createElement("div",{className:"sb-wordlist-window"},f.createElement(bt,null))))))}var Ct=document.getElementById("portal-game-toolbar"),St={help:"rules",save:"save-and-quit",ranks:"rankings",start:"get-started",congrats:"congrats",yesterday:"yesterdays-answers"};_t.propTypes={expandedWordlist:m.bool,isLocked:m.bool,unlockGame:m.func,lockGame:m.func,hasCompleted:m.bool,score:m.number,initialModal:m.string};var Lt=e.connect(function(e){var t=e.expandedWordlist,n=e.isLocked,r=De(e);return{expandedWordlist:t,isLocked:n,hasCompleted:r,score:We(e),initialModal:r?null:"start"}},function(e){return{lockGame:function(){return e({type:"LOCK"})},unlockGame:function(){return e({type:"UNLOCK"})}}})(_t),Tt=document.getElementById("pz-game-root");u.render(f.createElement(e.Provider,{store:function(e){var t=[r.applyMiddleware(n,pe,me)];window.__REDUX_DEVTOOLS_EXTENSION__&&t.push(window.__REDUX_DEVTOOLS_EXTENSION__());var a=r.createStore(oe,function(e){var t=e.today,n=e.yesterday;return Object.assign({},t,{input:[],foundWords:[],expandedWordlist:!1,isLocked:!1,message:null,yesterday:Object.assign({},n,{foundWords:[]}),userType:d.userType})}(e),r.compose.apply(void 0,t));return v(a,function(e){return a.dispatch(function(e){return{type:Te,payload:e}}(e))},function(e){return a.dispatch(function(e){return{type:Oe,payload:e}}(e))}),a.dispatch(ue()),window.userType.inShortzMode&&(window.cheat=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1,t=a.getState(),n=t.answers,r=t.foundWords;n.filter(function(e){return!r.includes(e)}).slice(0,e).forEach(function(e){return a.dispatch({type:Ne,payload:e})})},window.reset=function(){a.dispatch({type:Le})}),a}(d.getGameData())},f.createElement(Lt,null)),Tt)});
